/**
 * Created by hsuanlee on 16/05/2017.
 */
import fs from 'fs'
import fy from 'fanyi'
import request from 'request-promise'
import chalk from 'chalk'
import readFile from './src/read-file'
import parseWord from './src/parse-word'
import { getTranslation } from './src/translation'

const youdaoAPI = "http://fanyi.youdao.com/openapi.do?keyfrom=node-fanyi&key=110811608&type=data&doctype=json&version=1.1&q=${word}";

readFile('./md/ng.md', 'utf-8')
    .then(res => {
        let words =[...new Set(parseWord(res))];
        words.forEach( (e) => {
            getTranslation(e)

        })
    });

function youdao (data) {
    var firstLine = '';

    // word
    firstLine += data.query;

    // phonetic symbol
    if (data.basic && data.basic.phonetic) {
        firstLine += chalk.magenta('  [ ' + data.basic.phonetic + ' ]');
    }

    log(firstLine + chalk.gray('  ~  fanyi.youdao.com'));

    // pos & acceptation
    if (data.basic && data.basic.explains) {
        log();
        data.basic.explains.forEach(function(item) {
            log(chalk.gray('- ') + chalk.green(item));
        });
    }

    // sentence
    if (data.web && data.web.length) {
        log();
        data.web.forEach(function(item, i) {
            log(chalk.gray(i + 1 + '. ') + highlight(item.key, data.query));
            log('   ' + chalk.cyan(item.value.join(',')));
        });
    }

    log();
}

function log(message, indentNum) {
    indentNum = indentNum || 1;
    let indent = '';
    for (let i=1; i<indentNum; i++) {
        indent += '  ';
    }
    console.log(indent, message || '');
}

// function highlight(string, key, defaultColor) {
//     defaultColor = defaultColor || 'gray';
//     string = string.replace(new RegExp('(.*)(' + key + ')(.*)', 'gi'), '$1$2' + chalk[defaultColor]('$3'));
//     return string.replace(new RegExp('(.*?)(' + key + ')', 'gi'), chalk[defaultColor]('$1') + chalk.yellow('$2'));
// }